<div align="center">
  <a href="https://github.com/banyancomputer/tomb" target="_blank">
    <img src=".github/logo.png" alt="Banyan Logo" width="100"></img>
  </a>

  <h1 align="center">Banyan CLI</h1>

  <p>
    <a href="https://codecov.io/gh/banyancomputer/tomb">
      <img src="https://codecov.io/gh/banyancomputer/tomb/branch/master/graph/badge.svg?token=LQL6MA4KSI" alt="Code Coverage"/>
    </a>
    <a href="https://github.com/banyancomputer/tomb/actions?query=">
      <img src="https://github.com/banyancomputer/tomb/actions/workflows/tests_and_checks.yml/badge.svg" alt="Build Status">
    </a>
    <a href="https://github.com/banyancomputer/tomb/blob/main/LICENSE-MIT">
      <img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License-MIT">
    </a>
    <a href="https://discord.gg/aHaSw9zgwV">
      <img src="https://img.shields.io/static/v1?label=Discord&message=join%20us!&color=mediumslateblue" alt="Discord">
    </a>
  </p>
</div>

<div align="center"><sub>:warning: Work in progress :warning:</sub></div>

##

## Outline

- [Outline](#outline)
- [What is the Banyan CLI?](#what-is-the-banyan-cli)
- [Installation](#installation)
  - [Using `cargo`](#using-cargo)
- [Usage](#usage)
- [Testing the Project](#testing-the-project)
- [Benchmarking the Project](#benchmarking-the-project)
  - [Configuring the benchmarks](#configuring-the-benchmarks)
  - [Running the benchmarks](#running-the-benchmarks)
  - [Profiling the binary](#profiling-the-binary)
- [Contributing](#contributing)
  - [Formatting](#formatting)
  - [Pre-commit Hook](#pre-commit-hook)
  - [Recommended Development Flow](#recommended-development-flow)
  - [Conventional Commits](#conventional-commits)
- [Getting Help](#getting-help)
- [External Resources](#external-resources)
- [License](#license)


## What is the Banyan CLI?
The Banyan CLI library is a tool for indexing, chunking, encrypting and decrypting large files and directories into manageable and portable CAR files of blocks that don't leak information about the original filesystem, plus a reconstruction manifest.

It it interacts seamlessly with our Web API to present you with an interface that can encrypt filesystems from scratch, or connect up to an existing Banyan account. 

The CAR files generated by this tool can be uploaded to Filecoin, but we're happy to take care of that part too. Metadata files are optionally sent through Banyan's webapp, so you can share and manage your files from any device. Banyan handles all of this for its customers.

This repository uses [WNFS](https://github.com/wnfs-wg/rs-wnfs) to get features like granular and feature-packed cryptographic permissioning and file version control.

The core of this repository cross-compiles to WASM so you can access filesystems packed by the Banyan CLI in the browser.

It is meant to be used as a tool for preparing even large quantities of data for manageable archival storage on decentralized storage networks such as Filecoin. 

It's meant to run anywhere.

## Installation

### Using `cargo`

To install our CLI tool using `cargo`, run:
```console
cargo install --path banyan
```

[//]: # (TODO: Add more installation instructions here as we add more ways to install the project.)

## Usage
The Banyan CLI is easy to use. Create a new Drive, run:
```console
banyan drives create --name <NAME> --origin <ORIGIN>
```
Where `<NAME>` is a unique name for your new Drive and `<ORIGIN>` is the directory you want to create a Drive of.
To then encrypt this Drive, run:
```console
banyan drives prepare <--drive-id <DRIVE_ID> --name <NAME> | --origin <ORIGIN>>
```
This syntax is letting you know that you can use the Drive's `<NAME>`, its `<ORIGIN>`, or its unique generated `<DRIVE_ID>` as a way of telling the CLI which Drive you are referring to. 
The `prepare` command finds the correct Drive, scans your filesystem for any changes to it, and encrypts the data locally as a means of preparing it either for our services or for Filecoin directly.

To sync this encrypted data with our services:
```console
banyan drives sync <--drive-id <DRIVE_ID> --name <NAME> | --origin <ORIGIN>>
```
The `sync` command determines if you are behind or ahead of the Drive we have persisted remotely and runs the appropriate networking code to transfer metadata and CAR files as needed.

To decrypt a Drive, run:
```console
banyan drives restore <--drive-id <DRIVE_ID> --name <NAME> | --origin <ORIGIN>>
```
The `restore` command will either reconstruct new data in the original directory specified, or create a new one if that directory is no longer available.
The Banyan CLI can intelligently use remote backups to reconstruct your files directly, even if you have no CAR files cached on disk.

## Testing the Project
- Run tests

  ```console
  cargo test --features cli
  ```
  This should run all the tests in the workspace.

## Contributing

:balloon: We're thankful for any feedback and help in improving our project!
We have a [contributing guide](./CONTRIBUTING.md) to help you get involved. We
also adhere to our [Code of Conduct](./CODE_OF_CONDUCT.md).

### Formatting

For formatting Rust in particular, please use `cargo fmt` as it uses
specific nightly features we recommend by default.

### Pre-commit Hook

This project recommends using [pre-commit][pre-commit] for running pre-commit

hooks. Please run this before every commit and/or push.

- Install pre-commit on this project

  ```console
  pre-commit install
  ```

- If you are doing interim commits locally, and for some reason if you _don't_

  want pre-commit hooks to fire, you can run

  `git commit -a -m "Your message here" --no-verify`.

### Recommended Development Flow

- We recommend leveraging [cargo-watch][cargo-watch],
  [cargo-expand][cargo-expand] and [irust][irust] for Rust development.
- We recommend using [cargo-udeps][cargo-udeps] for
- emoving unused dependencies
  before commits and pull-requests.

### Conventional Commits

This project *lightly* follows the [Conventional Commits
convention][commit-spec-site] to help explain
commit history and tie in with our release process. The full specification
can be found [here][commit-spec]. We recommend prefixing your commits with
a type of `fix`, `feat`, `docs`, `ci`, `refactor`, etc..., structured like so:

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

## Getting Help

For usage questions, usecases, or issues reach out to us in our [Discord channel](https://discord.gg/aHaSw9zgwV).

We would be happy to try to answer your question or try opening a new issue on Github.

## External Resources

These are references to specifications, talks and presentations, etc.

## License

[buildx]: https://github.com/docker/buildx
[cargo-expand]: https://github.com/dtolnay/cargo-expand
[cargo-udeps]: https://github.com/est31/cargo-udeps
[cargo-watch]: https://github.com/watchexec/cargo-watch
[commit-spec]: https://www.conventionalcommits.org/en/v1.0.0/#specification
[commit-spec-site]: https://www.conventionalcommits.org/
[criterion]: https://github.com/bheisler/criterion.rs
[fake-file]: https://crates.io/crates/fake-file
[docker-engine]: https://docs.docker.com/engine/
[direnv]:https://direnv.net/
[irust]: https://github.com/sigmaSd/IRust
[nix]:https://nixos.org/download.html
[nix-flake]: https://nixos.wiki/wiki/Flakes
[pre-commit]: https://pre-commit.com/
[proptest]: https://github.com/proptest-rs/proptest
[strategies]: https://docs.rs/proptest/latest/proptest/strategy/trait.Strategy.html
[flamegraph]: https://github.com/flamegraph-rs/flamegraph
